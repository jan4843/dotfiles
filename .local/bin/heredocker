#!/bin/sh -e

for arg in "$@"; do
	if [ -z "$reset_args" ]; then
		set --
		reset_args=1
	fi

	case "$arg" in
		[0-9]*:[0-9]*)
			set -- --publish="$arg" "$@"
			;;
		[0-9]*/*)
			port=${arg%/*}
			proto=${arg#*/}
			set -- --publish="$port:$port/$proto" "$@"
			;;
		[0-9]*)
			set -- --publish="$arg:$arg" "$@"
			;;
		.:*|..:*|./:*|./*:*|../:*|../*:*|/*:*)
			src=$(cd "${arg%%:*}" && pwd)
			dst=${arg#*:}
			set -- --volume="$src:$dst" "$@"
			;;
		.|..|./*|../*|/*)
			workdir=$(cd "$arg" && pwd)
			set -- --volume="$workdir:/host" --workdir="/host" "$@"
			;;
		$)
			cmd='command -v bash > /dev/null && exec bash "$@" || exec sh "$@"'
			set -- --entrypoint=sh "$@" -c "$cmd"
			;;
		*)
			set -- "$@" "$arg"
			;;
	esac
done

if [ -t 0 ]; then
	set -- --tty "$@"
fi

set -- docker container run --rm --init --interactive "$@"
echo "$@"
exec "$@"
